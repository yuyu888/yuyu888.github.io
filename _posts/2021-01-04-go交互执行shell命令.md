---
layout: mypost
title: go 交互执行shell命令
categories: [Golang]
---

## 背景
当我执行一些shell命令时， 经常会要求我们输入yes 或者 用户名/密码；如果我们想要编写一个自动化运行的shell脚本，希望程序自动帮助我们填写，原生的shell是不支持的， 需要单独安装expect； 可以参考：[expect自动输入密码、命令](https://www.chenyudong.com/archives/expect-non-interactive-ssh-login-password-authentication.html){:target="_blank"}

由于目前多用go语言开发，而且go也很容易打包成可执行文件，操作起来非常方便，并且可以结合shell和本身的语法完成更加复杂的业务， 所以本文主要介绍通过go来实现交互执行shell命令；

## 实例

以ssh 为例， 主要是通过 github.com/ThomasRooney/gexpect 来实现

gossh.go
````go
package main

import (
	"log"
	"time"

	"github.com/ThomasRooney/gexpect"
)

func main() {
	// cmd := "sh ./test.sh"
    cmd := `ssh username@server_ip`
    // 	cmd := `ssh username@server_ip "ls"` // 登录后执行ls 命令
	pwd := "yourpassword"

	child, err := gexpect.Spawn(cmd)
	if err != nil {
		log.Fatal("Spawn cmd error ", err)
	}

	if err := child.ExpectTimeout("password:", 10*time.Second); err != nil {
		log.Fatal("Expect timieout error ", err)
	}

	if err := child.SendLine(pwd); err != nil {
		log.Fatal("SendLine password error ", err)
	}

    // child.Expect("password:")
	// child.SendLine(pwd)
	child.Interact()
	child.Close()
}

````